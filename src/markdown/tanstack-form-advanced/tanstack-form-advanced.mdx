import Image from "next/image"
import Link from "next/link"
import InformationBanner from "@/markdown/-components/information-banner";
import ExternalLink from "@/markdown/-components/external-link";
import LinkWithGlimpse from "@/markdown/-components/link-with-glimpse";

export const metadata = {
  title: "Cr√©er des formulaires modernes et type-safe avec TanStack Form üìù [Bonus]",
  date: "2025-08-16",
  excerpt:
    "Passer √† la vitesse sup√©rieure sur les formulaires avec TanStack Form.",
  publish: true,
};

Apr√®s la <LinkWithGlimpse url="https://www.frenchdev.co/post/tanstack-form-1" internalLink={true}>mise en place d'un formulaire TanStack Form (partie 1)</LinkWithGlimpse> puis <LinkWithGlimpse url="https://www.frenchdev.co/post/tanstack-form-2" internalLink={true}>l'ajout de validations et l'affichage d'erreurs (partie 2)</LinkWithGlimpse>, voici quelques **id√©es d'am√©lioration faciles dont peuvent b√©n√©ficier la plupart des formulaires et faciles √† mettre en ≈ìuvre avec TanStack Form**.

### Tip #1 - Ajouter un d√©lai avant validation (*debounce*)

Lorsqu'on souhaite valider un *input* √† la fin d'une saisie, **introduire un l√©ger d√©lai avant v√©rification** √©vite d'enclencher une validation pr√©matur√©e inutile. Cette pause pour s'assurer que l'*input* est "stabilis√©" avant de le tester permet d'optimiser notre formulaire surtout si la validation requiert un appel API. 

Si on combine `OnChangeAsyncDebounceMs` avec `onChangeAsync` on peut ainsi trouver un **rythme de validation plus intelligent** üëá
<br/>

```tsx {18-21}
  function validateUsername(value: string) {
    fetch(`/api/validate-username?username=${value}`)
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          return "Ce nom d'utilisateur est d√©j√† pris"
        }
        return null
      })
      .catch(error => {
        return "Une erreur est survenue lors de la validation du nom d'utilisateur"
      })
  }

  <form.Field 
        name="username" 
        validators={
          // On prend ici pour l'exemple une validation asynchrone
          // mais on peut aussi introduire un debounce sur une validation synchrone
          onChangeAsyncDebounceMs: 500,
          onChangeAsync: ({ value }) => validateUsername(value),
          onChange: ({ value }) => {
            if (value.length < 3) {
              return "Le nom d'utilisateur doit contenir au moins 3 caract√®res"
            }
          }
        }
        children={({ field }) => 
          <input 
            id={field.id} 
            type="text"
            name={field.name} 
            value={field.state.value}
            onChange={(e) => field.handleChange(e.target.value)}
          />
        }
      />
```


### Tip #2 - Ajouter un indicateur de validation en cours

Quelle que soit la dur√©e de la validation, n'importe quel champ peut afficher son propre indicateur de validation en regardant son `field.getMeta().isValidating`.

```tsx {12}
  <form.Field 
        name="username" 
        children={({ field }) => 
          <>
            <input 
              id={field.id} 
              type="text"
              name={field.name} 
              value={field.state.value}
              onChange={(e) => field.handleChange(e.target.value)}
            />
            {field.getMeta().isValidating && <div>Validation en cours...</div>}
          </>
        }
      />
```

### Tip #3 - Valider plusieurs champs en m√™me temps

Pensons √† l'exemple courant d'un formulaire de cr√©ation de compte comportant un champ pour entrer un mot de passe et un autre pour le confirmer en le rentrant √† l'identique. Chacun de ces champs n'est valide que **si l'autre contient la m√™me valeur**. 

En pr√©cisant √† `onChangeListenTo` ou `onBlurListenTo` le tableau de champs qu'on souhaite lui lier, on s'assure que **les deux champs sont toujours re-valid√©s en m√™me temps m√™me si l'utilisateur n'interagit qu'avec l'un des deux**.

```tsx {4,24}
  <form.Field 
        name="password" 
        validators={{
          onChangeListenTo: ["confirmPassword"],
          onChange: ({ value, fieldApi }) => {
            if (value !== fieldApi.form.getFieldValue("confirmPassword")) {
              return "Les mot de passe ne correspondent pas"
            }
          }
        }}
        children={({ field }) => 
            <input 
              id={field.id} 
              type="password"
              name={field.name} 
              value={field.state.value}
              onChange={(e) => field.handleChange(e.target.value)}
            />
        }
      />
  <form.Field 
        name="confirmPassword" 
        validators={{
          onChangeListenTo: ["password"],
          onChange: ({ value, fieldApi }) => {
            if (value !== fieldApi.form.getFieldValue("password")) {
              return "Les mot de passe ne correspondent pas"
            }
          }
        }}
        children={({ field }) => 
            <input 
              id={field.id} 
              type="password"
              name={field.name} 
              value={field.state.value}
              onChange={(e) => field.handleChange(e.target.value)}
            />
        }
      />
```

On remarquera au passage que nous pouvons r√©cup√©rer au niveau du `field` n'importe quelle valeur du `form` gr√¢ce √† `fieldApi.form.getFieldValue()` ü§ì

### Tip #4 - Utiliser une librairie de validation externe

Plut√¥t que de d√©finir notre logique de validation √† l'aide de fonctions pass√©es dans les `validators` du formulaire ou du champ, **TanStack Form laisse la possibilit√© d'utiliser des sch√©mas de validation** de <LinkWithGlimpse url="https://zod.dev/">Zod</LinkWithGlimpse>, <LinkWithGlimpse url="https://valibot.dev/">Valibot</LinkWithGlimpse>, <LinkWithGlimpse url="https://arktype.io/">ArkType</LinkWithGlimpse> et autres librairies pour d√©finir nos r√®gles.

<InformationBanner>
  L'association de TanStack Form avec une librairie de validation requiert parfois d'installer un adaptateur pour faire le pont entre les deux. Dans le cas de Zod, on l'obtient avec `npm install @tanstack/zod-form-adapter`
</InformationBanner>

On passe ensuite notre sch√©ma de validation √† `onChange`, `onBlur`ou `onSubmit` au niveau du champ... üëá

```tsx {5,22-23}
import { zodValidator } from "@tanstack/zod-form-adapter"
import { z } from "zod"
import { useForm } from "@tanstack/react-form"

const PasswordSchema = z.string().min(8, "Le mot de passe doit contenir au moins 8 caract√®res")

  <form.Field 
        name="password" 
        validators={{
          onChange: ({ value, fieldApi }) => {
            if (value !== fieldApi.form.getFieldValue("confirmPassword")) {
              return "Les mot de passe ne correspondent pas"
            }
          }
        }}
        children={({ field })> 
            <input 
              id={field.id} 
              type="password"
              name={field.name} 
              value={field.state.value}
              validatorAdapter={zodValidator}
              onChange={PasswordSchema}
            />
        }
      />
```

...ou du formulaire tout entier üëá

```tsx {5-8,16}
import { useForm } from "@tanstack/react-form"
import { zodValidator } from "@tanstack/zod-form-adapter"
import { z } from "zod"

const LoginSchema = z.object({
  username: z.string().min(3, "Le nom de l'utilisateur doit contenir au moins 3 caract√®res"),
  password: z.string().min(8, "Le mot de passe doit contenir au moins 8 caract√®res")
})

const form = useForm({ 
  defaultValues: {
    username: "",
    password: "",
  },
  validators: {
    onChange: LoginSchema,
  },
  validatorAdapter: zodValidator(),
  onSubmit: async ({ value}) => {
    console.log(value)
  },
 })
```

<div className="useful-links">
  #### üîó Liens additionnels 
  - <ExternalLink/> <LinkWithGlimpse url="https://tanstack.com/form/latest/docs/overview">Documentation officielle de TanStack Form</LinkWithGlimpse>
  - <ExternalLink/> <LinkWithGlimpse url="https://www.youtube.com/watch?v=Pf1qn35bgjs&list=PLOQjd5dsGSxInTKUWTxyqSKwZCjDIUs0Y&index=1">TanStack Form Tutorial - Balastrong</LinkWithGlimpse>
  - <ExternalLink/> <LinkWithGlimpse url="https://blog.logrocket.com/tanstack-form-vs-react-hook-form">LogRocket ‚Äî TanStack Form vs. React Hook Form</LinkWithGlimpse>
</div>